macro init_krpt;
{
init_krpt :
 movq mm0,rdx;                       запомнить базовый вектор инициализации

;////////////////////////////////////////////////////////////////////////////
;///////////////////технологические маски////////////////////////////////////
;////////////////////////////////////////////////////////////////////////////
;////////////////////////////////////////////////////////////////////
;//////////////////////перестановки//////////////////////////////////
; f e d c  b a 9 8  7 6 5 4  3 2 1 0

;0c040008 09050e01 0b020d06 070f030a
;0d060803 0900050c 040e010a 0b07020f
;0408030f 02050d0b 0e0a0601 0c000709
;0a0c0204 0d080106 000b0f07 0e050903
;00050f0a 0801060d 0903070e 0b040c02
;050d0901 06020c0a 0308070f 000b040e
;08050e02 0c060b01 0f040900 0d0a0307
;020d0b07 05080f00 04030a0c 01060e09

;///////////////////индексы статической перестановки 1
; f e d c  b a 9 8  7 6 5 4  3 2 1 0
;0c040008 09050e01 0b020d06 070f030a
;0d060803 0900050c 040e010a 0b07020f

 mov r14,0b020d06070f030ah;
  mov rdx,0c04000809050e01h;
   mov r8,040e010a0b07020fh;
    mov r9,0d0608030900050ch;
 mov [rcx+0100h],r14;
  mov [rcx+0108h],rdx;
   mov [rcx+0110h],r8;
    mov [rcx+0118h],r9;

;///////////////////индексы статической перестановки 2
; f e d c  b a 9 8  7 6 5 4  3 2 1 0
;0408030f 02050d0b 0e0a0601 0c000709
;0a0c0204 0d080106 000b0f07 0e050903

 mov r14,0e0a06010c000709h;
  mov rdx,0408030f02050d0bh;
   mov r8,000b0f070e050903h;
    mov r9,0a0c02040d080106h;
 mov [rcx+0120h],r14;
  mov [rcx+0128h],rdx;
   mov [rcx+0130h],r8;
    mov [rcx+0138h],r9;

;///////////////////индексы статической перестановки 3
; f e d c  b a 9 8  7 6 5 4  3 2 1 0
;00050f0a 0801060d 0903070e 0b040c02
;050d0901 06020c0a 0308070f 000b040e

 mov r14,0903070e0b040c02h;
  mov rdx,00050f0a0801060dh;
   mov r8,0308070f000b040eh;
    mov r9,050d090106020c0ah;
 mov [rcx+0140h],r14;
  mov [rcx+0148h],rdx;
   mov [rcx+0150h],r8;
    mov [rcx+0158h],r9;

;///////////////////индексы статической перестановки 4
; f e d c  b a 9 8  7 6 5 4  3 2 1 0
;08050e02 0c060b01 0f040900 0d0a0307
;020d0b07 05080f00 04030a0c 01060e09

 mov r14,0f0409000d0a0307h;
  mov rdx,08050e020c060b01h;
   mov r8,04030a0c01060e09h;
    mov r9,020d0b0705080f00h;
 mov [rcx+0160h],r14;
  mov [rcx+0168h],rdx;
   mov [rcx+0170h],r8;
    mov [rcx+0178h],r9;

;////////////////блоки замен переделанные в перестановки
; f  e  d  c  b  a  9  8    7  6  5  4  3  2  1  0
;08 03 09 02 00 05 01 07   04 0f 0e 0c 0b 0a 06 0d
;0c 04 06 0e 02 07 05 03   0d 0b 0a 08 01 00 09 0f

;0a 01 07 0f 0c 00 03 05   02 09 08 06 04 0e 0d 0b
;02 0a 09 05 0f 0d 06 0c   00 04 0b 0e 08 01 07 03

;01 04 0e 0b 0d 07 00 0f   02 08 06 03 09 0a 05 0c
;07 00 05 0a 03 0e 0b 01   08 02 0c 09 0d 04 0f 06

;0b 07 08 01 04 03 0e 00   05 0d 06 02 0f 0c 0a 09
;04 0a 0f 06 09 0c 02 0b   01 03 0e 0d 00 05 08 07


;//////////блоки замен
 mov r8,040f0e0c0b0a060dh;
  mov r9,0803090200050107h;
   mov r10,0d0b0a080100090fh;
    mov r11,0c04060e02070503h;
     mov r12,02090806040e0d0bh;
      mov r13,0a01070f0c000305h;
       mov r14,00040b0e08010703h;
        mov rdx,020a09050f0d060ch;

;//////////блоки замен 1-8 потока
 mov qword [rcx+180h],r8;                 блоки замен 1-2блок
  mov qword [rcx+188h],r9;
   mov qword [rcx+190h],r10;              блоки замен 3-4блок
    mov qword [rcx+198h],r11;
     mov qword [rcx+1a0h],r12;            блоки замен 5-6блок
      mov qword [rcx+1a8h],r13;
       mov qword [rcx+1b0h],r14;          блоки замен 7-8блок
        mov qword [rcx+1b8h],rdx;


; f  e  d  c  b  a  9  8    7  6  5  4  3  2  1  0
;01 04 0e 0b 0d 07 00 0f   02 08 06 03 09 0a 05 0c
;07 00 05 0a 03 0e 0b 01   08 02 0c 09 0d 04 0f 06

;0b 07 08 01 04 03 0e 00   05 0d 06 02 0f 0c 0a 09
;04 0a 0f 06 09 0c 02 0b   01 03 0e 0d 00 05 08 07

;//////////блоки замен
 mov r8,02080603090a050ch;
  mov r9,01040e0b0d07000fh;
   mov r10,08020c090d040f06h;
    mov r11,0700050a030e0b01h;
     mov r12,050d06020f0c0a09h;
      mov r13,0b07080104030e00h;
       mov r14,01030e0d00050807h;
        mov rdx,040a0f06090c020bh;

 mov qword [rcx+1c0h],r8;                 блоки замен 1-2блок
  mov qword [rcx+1c8h],r9;
   mov qword [rcx+1d0h],r10;              блоки замен 3-4блок
    mov qword [rcx+1d8h],r11;
     mov qword [rcx+1e0h],r12;            блоки замен 5-6блок
      mov qword [rcx+1e8h],r13;
       mov qword [rcx+1f0h],r14;          блоки замен 7-8блок
        mov qword [rcx+1f8h],rdx;

;//////////////////////////////////////////////////////////////////
;//////////////////////инициализация накопителей и сумматора
;//////////////////////////////////////////////////////////////////
;////////////////маска сдвига
 mov dword [rcx+000h],01fh;
  vbroadcastss ymm14,[rcx+000h];
   vmovupd [rcx+000h],ymm14;

;////////////////маска обратного сдвига
 mov dword [rcx+020h],020h;
  vbroadcastss ymm15,[rcx+020h];
   vmovupd [rcx+020h],ymm15;

;///////////////////первоначальное заполнение - все накопители нулевые
 vpxor ymm0,ymm0,ymm0;
  vpxor ymm1,ymm1,ymm1;
   vpxor ymm2,ymm2,ymm2;
    vpxor ymm3,ymm3,ymm3;
     vpxor ymm4,ymm4,ymm4;
      vpxor ymm5,ymm5,ymm5;
       vpxor ymm6,ymm6,ymm6;
 vmovupd [rcx+060h],ymm0;
  movq [rcx+060h],mm0;                   инициализирующее число
   vmovupd ymm7,[rcx+060h];
    mov qword [rcx+0a0h],0;              начальное значение счетчика в сессии

;//////////////////////формирование начального состояния накопителей в сессии
 mov esi,0100h;
  mov r14,rcx;

ckl_s :
cgi ymm0, ymm1, ymm2, ymm3, ymm4, ymm5, ymm6, ymm7;
 sub esi,1;
  jnz ckl_s;

 vmovupd [rcx+0200h],ymm0;         запомнить начальное значения накопителей
  vmovupd [rcx+0220h],ymm4;
   vmovupd [rcx+0240h],ymm1;
    vmovupd [rcx+0260h],ymm5;
     vmovupd [rcx+0280h],ymm2;
      vmovupd [rcx+02a0h],ymm6;
       vmovupd [rcx+02c0h],ymm3;
        vmovupd [rcx+02e0h],ymm7;
 ret;

}

